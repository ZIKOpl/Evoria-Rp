<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Admin â€” District WL</title>
  <link rel="icon" type="image/png" href="../assets/logo.png">
  <link rel="apple-touch-icon" href="../assets/logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --p: #7C6EE8; --p2: #6B5DD3; --p3: #A095F5; --acc: #C4B8FF;
      --mag: #D976E8; --cyan: #5DD8ED; --green: #52D9A4; --red: #F07070; --gold: #F5C842;
      --dark: #0F0F1C; --d1: #141427; --d2: #191932; --d3: #1F1F3A; --d4: #272745; --d5: #32325A;
      --muted: #8E8EC0; --text: #EAE8FF; --border: rgba(160,149,245,.15);
      --ff-title: 'Rajdhani', sans-serif;
      --ff-body: 'Outfit', sans-serif;
      --ease: cubic-bezier(.4,0,.2,1);
      --t: .22s; --r: 12px;
    }
    html { scroll-behavior: smooth; }
    body { font-family: var(--ff-body); background: var(--dark); color: var(--text); min-height: 100vh; }
    body::before {
      content: '';
      position: fixed; inset: 0; pointer-events: none; z-index: 0;
      background: radial-gradient(ellipse 70% 50% at 15% 0%, rgba(124,110,232,.08) 0%, transparent 55%),
                  radial-gradient(ellipse 50% 40% at 85% 100%, rgba(93,216,237,.05) 0%, transparent 55%);
    }
    a { text-decoration: none; color: inherit; }
    button { font-family: var(--ff-body); cursor: pointer; border: none; }
    img { display: block; max-width: 100%; }
    ::-webkit-scrollbar { width: 5px; } ::-webkit-scrollbar-track { background: var(--dark); } ::-webkit-scrollbar-thumb { background: var(--p); border-radius: 4px; }

    #app { display: flex; min-height: 100vh; position: relative; z-index: 1; }

    .sidebar {
      width: 240px; flex-shrink: 0;
      background: linear-gradient(180deg, var(--d2), var(--d1));
      border-right: 1px solid var(--border);
      display: flex; flex-direction: column;
      position: fixed; top: 0; left: 0; bottom: 0;
      z-index: 100; transition: transform var(--t);
    }
    .sidebar-logo {
      padding: 1.5rem 1.4rem 1.2rem;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: .75rem;
    }
    .sidebar-logo img { width: 36px; height: 36px; border-radius: 8px; }
    .sidebar-logo-text {
      font-family: var(--ff-title); font-size: 1rem; font-weight: 700;
      letter-spacing: 2px; background: linear-gradient(135deg, var(--acc), var(--mag));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .sidebar-logo-sub { font-size: .65rem; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; }

    .sidebar-nav { flex: 1; padding: 1rem .75rem; display: flex; flex-direction: column; gap: .2rem; }
    .snav-section { font-size: .62rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: var(--muted); padding: .6rem .5rem .3rem; }
    .snav-item {
      display: flex; align-items: center; gap: .65rem;
      padding: .62rem .75rem; border-radius: 9px;
      font-size: .82rem; font-weight: 600; color: var(--muted);
      transition: color var(--t), background var(--t); cursor: pointer;
    }
    .snav-item:hover { color: var(--text); background: rgba(160,149,245,.08); }
    .snav-item.active { color: var(--acc); background: rgba(124,110,232,.15); }
    .snav-item svg { flex-shrink: 0; opacity: .7; }
    .snav-item.active svg { opacity: 1; }

    .sidebar-user {
      padding: 1rem .75rem;
      border-top: 1px solid var(--border);
      display: flex; align-items: center; gap: .7rem;
    }
    .sidebar-avatar { width: 34px; height: 34px; border-radius: 50%; border: 2px solid rgba(160,149,245,.3); flex-shrink: 0; }
    .sidebar-uname { font-size: .82rem; font-weight: 700; color: var(--text); }
    .sidebar-ubadge { font-size: .62rem; color: var(--mag); font-weight: 700; letter-spacing: .5px; text-transform: uppercase; }
    .sidebar-logout {
      margin-left: auto; background: transparent; border: 1px solid rgba(240,112,112,.2);
      color: var(--red); border-radius: 7px; padding: .3rem .55rem; font-size: .7rem;
      font-weight: 700; transition: background var(--t), border-color var(--t);
    }
    .sidebar-logout:hover { background: rgba(240,112,112,.12); border-color: rgba(240,112,112,.4); }

    .main { margin-left: 240px; flex: 1; padding: 2rem 2.5rem; min-width: 0; }

    .page-header { margin-bottom: 2rem; }
    .page-eyebrow { font-size: .68rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: var(--p3); margin-bottom: .3rem; }
    .page-title { font-family: var(--ff-title); font-size: 2rem; font-weight: 700; letter-spacing: 1px; color: var(--text); }

    .section { display: none; }
    .section.active { display: block; }

    .card {
      background: linear-gradient(145deg, var(--d2), var(--d3));
      border: 1px solid var(--border); border-radius: 16px;
      padding: 1.5rem;
    }
    .card-title {
      font-size: .68rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase;
      color: var(--muted); margin-bottom: 1.1rem;
      display: flex; align-items: center; gap: .5rem;
    }
    .card-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.2rem; }

    /* â”€â”€ FORMS â”€â”€ */
    .fgroup { margin-bottom: .9rem; }
    .flabel { display: block; font-size: .72rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--muted); margin-bottom: .4rem; }
    .finput {
      width: 100%; background: rgba(10,0,0,.75); border: 1px solid var(--border);
      border-radius: 9px; padding: .65rem .9rem;
      color: var(--text); font-family: var(--ff-body); font-size: .9rem;
      transition: border-color var(--t), box-shadow var(--t);
    }
    .finput:focus { outline: none; border-color: var(--p3); box-shadow: 0 0 0 3px rgba(124,110,232,.12); }
    .ftextarea {
      width: 100%; background: rgba(10,0,0,.75); border: 1px solid var(--border);
      border-radius: 9px; padding: .65rem .9rem; min-height: 90px; resize: vertical;
      color: var(--text); font-family: var(--ff-body); font-size: .9rem;
      transition: border-color var(--t), box-shadow var(--t);
    }
    .ftextarea:focus { outline: none; border-color: var(--p3); box-shadow: 0 0 0 3px rgba(124,110,232,.12); }

    .btn-add {
      display: inline-flex; align-items: center; gap: .45rem;
      background: linear-gradient(135deg, var(--p), var(--p2));
      color: #fff; border: none; border-radius: 9px;
      padding: .65rem 1.2rem; font-weight: 700; font-size: .83rem; letter-spacing: .3px;
      box-shadow: 0 3px 14px rgba(124,110,232,.3);
      transition: transform var(--t), box-shadow var(--t), background var(--t);
    }
    .btn-add:hover { transform: translateY(-1px); box-shadow: 0 6px 22px rgba(124,110,232,.4); background: linear-gradient(135deg, var(--p2), #9333EA); }
    .btn-full {
      display: block; width: 100%;
      background: linear-gradient(135deg, var(--p), var(--p2));
      color: #fff; border: none; border-radius: 9px;
      padding: .72rem; font-weight: 700; font-size: .88rem;
      box-shadow: 0 3px 14px rgba(124,110,232,.25);
      transition: transform var(--t), box-shadow var(--t);
    }
    .btn-full:hover { transform: translateY(-1px); box-shadow: 0 6px 22px rgba(124,110,232,.4); }

    /* â”€â”€ LIST ITEMS (news / streamers / admins) â”€â”€ */
    .list-area { margin-top: 1.2rem; display: flex; flex-direction: column; gap: .55rem; }
    .list-item {
      display: flex; align-items: center; gap: .75rem;
      background: var(--d4); border: 1px solid rgba(160,149,245,.08);
      border-radius: 10px; padding: .7rem 1rem;
      transition: border-color var(--t), background var(--t);
    }
    .list-item:hover { border-color: rgba(160,149,245,.18); background: var(--d5); }
    .list-thumb {
      width: 44px; height: 44px; border-radius: 8px; object-fit: cover; flex-shrink: 0;
      background: var(--d5); display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem; color: var(--muted); overflow: hidden;
    }
    .list-thumb img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }
    .list-info { flex: 1; min-width: 0; }
    .list-name { font-weight: 700; font-size: .88rem; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .list-meta { font-size: .73rem; color: var(--muted); margin-top: .15rem; }
    .list-actions { display: flex; gap: .4rem; flex-shrink: 0; }
    .btn-icon {
      width: 28px; height: 28px; border-radius: 6px; border: none;
      display: flex; align-items: center; justify-content: center; font-size: .85rem;
      transition: background var(--t);
    }
    .btn-icon.pin  { background: rgba(245,200,66,.1); color: var(--gold); }
    .btn-icon.pin:hover  { background: rgba(245,200,66,.2); }
    .btn-icon.pin.active { background: rgba(245,200,66,.25); color: var(--gold); }
    .btn-icon.star { background: rgba(93,216,237,.08); color: var(--cyan); }
    .btn-icon.star:hover  { background: rgba(93,216,237,.18); }
    .btn-icon.star.active { background: rgba(93,216,237,.22); }
    .btn-icon.del  { background: rgba(240,112,112,.08); color: var(--red); }
    .btn-icon.del:hover  { background: rgba(240,112,112,.2); }
    .drag-handle { color: var(--muted); font-size: 1rem; cursor: grab; user-select: none; padding: 0 .2rem; }
    .drag-handle:active { cursor: grabbing; }
    .list-item.dragging { opacity: .45; border-color: var(--p3); }

    /* â”€â”€ TAG badge â”€â”€ */
    .tag-badge {
      display: inline-block; background: rgba(124,110,232,.18); color: var(--p3);
      border: 1px solid rgba(124,110,232,.25);
      border-radius: 4px; font-size: .65rem; font-weight: 700; letter-spacing: .5px;
      text-transform: uppercase; padding: .1rem .45rem;
    }

    /* â”€â”€ Preview card â”€â”€ */
    .preview-wrap { background: var(--d4); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .preview-img { width: 100%; height: 140px; object-fit: cover; background: var(--d5); display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--muted); }
    .preview-img img { width: 100%; height: 100%; object-fit: cover; }
    .preview-body { padding: 1rem; }
    .preview-ptag { font-size: .65rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--p3); margin-bottom: .4rem; }
    .preview-ptitle { font-weight: 800; font-size: .95rem; margin-bottom: .35rem; }
    .preview-pdesc { font-size: .78rem; color: var(--muted); line-height: 1.5; }

    /* â”€â”€ Admins section â”€â”€ */
    .admin-id { font-size: .72rem; color: var(--muted); font-family: monospace; }
    .admin-note {
      margin-top: 1rem; padding: .85rem 1rem; background: rgba(124,110,232,.07);
      border: 1px solid rgba(124,110,232,.15); border-radius: 9px;
      font-size: .78rem; color: var(--muted); line-height: 1.6;
    }
    .admin-note code { color: var(--acc); background: rgba(124,110,232,.12); border-radius: 4px; padding: .1em .4em; font-size: .85em; }

    /* â”€â”€ Toast â”€â”€ */
    .toast-wrap { position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 9000; display: flex; flex-direction: column; gap: .5rem; pointer-events: none; }
    .toast {
      background: var(--d3); border: 1px solid var(--border); border-radius: 10px;
      padding: .65rem 1rem; font-size: .82rem; font-weight: 600; color: var(--text);
      box-shadow: 0 8px 32px rgba(0,0,0,.4);
      transform: translateX(110%); opacity: 0; transition: transform .3s var(--ease), opacity .3s;
    }
    .toast.in { transform: translateX(0); opacity: 1; }
    .toast.ok { border-color: rgba(82,217,164,.3); color: var(--green); }
    .toast.err { border-color: rgba(240,112,112,.3); color: var(--red); }

    /* â”€â”€ Empty state â”€â”€ */
    .empty { text-align: center; padding: 2.5rem 1rem; color: var(--muted); font-size: .85rem; }
    .empty-icon { font-size: 2rem; margin-bottom: .75rem; opacity: .5; }

    /* â”€â”€ Stat cards â”€â”€ */
    .stat-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .stat-card {
      background: linear-gradient(145deg, var(--d2), var(--d3));
      border: 1px solid var(--border); border-radius: 14px;
      padding: 1.2rem 1.4rem;
    }
    .sc-label { font-size: .68rem; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; color: var(--muted); margin-bottom: .4rem; }
    .sc-val { font-family: var(--ff-title); font-size: 2rem; font-weight: 700; color: var(--acc); }

    /* â”€â”€ Mobile toggle â”€â”€ */
    .mob-toggle {
      display: none; position: fixed; top: 1rem; left: 1rem; z-index: 200;
      background: var(--d3); border: 1px solid var(--border); border-radius: 8px;
      width: 38px; height: 38px; align-items: center; justify-content: center;
      color: var(--text); font-size: 1.1rem;
    }
    .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.6); z-index: 99; }

    @media (max-width: 900px) {
      .sidebar { transform: translateX(-100%); }
      .sidebar.mob-open { transform: translateX(0); }
      .sidebar-overlay.show { display: block; }
      .mob-toggle { display: flex; }
      .main { margin-left: 0; padding: 1.2rem 1.2rem 1.2rem 3.8rem; }
      .grid-2 { grid-template-columns: 1fr; }
      .grid-3 { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 540px) {
      .grid-3 { grid-template-columns: 1fr; }
      .main { padding: 1rem 1rem 1rem 3.5rem; }
    }
  </style>
</head>
<body>

<button class="mob-toggle" id="mob-toggle" aria-label="Menu">â˜°</button>
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<div id="app">

  <!-- â”€â”€ SIDEBAR â”€â”€ -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <img src="../assets/logo.png" alt="District WL" onerror="this.style.display='none'">
      <div>
        <div class="sidebar-logo-text">DISTRICT WL</div>
        <div class="sidebar-logo-sub">Panel Admin</div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="snav-section">Tableau de bord</div>
      <div class="snav-item active" data-tab="news" onclick="showTab('news', this)">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        ActualitÃ©s
      </div>
      <div class="snav-item" data-tab="streamers" onclick="showTab('streamers', this)">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
        Streamers
      </div>
      <div class="snav-item" data-tab="admins" onclick="showTab('admins', this)">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Administrateurs
      </div>

      <div class="snav-section" style="margin-top:.75rem">Navigation</div>
      <a href="../index.html" class="snav-item">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        Retour au site
      </a>
    </nav>

    <div class="sidebar-user">
      <img class="sidebar-avatar" id="user-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" alt="">
      <div>
        <div class="sidebar-uname" id="user-name">â€”</div>
        <div class="sidebar-ubadge">Admin</div>
      </div>
      <button class="sidebar-logout" onclick="logout()">Quitter</button>
    </div>
  </aside>

  <!-- â”€â”€ MAIN â”€â”€ -->
  <main class="main">

    <!-- â•â• ACTUALITÃ‰S â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="section active" id="sec-news">
      <div class="page-header">
        <div class="page-eyebrow">Gestion du contenu</div>
        <div class="page-title">ActualitÃ©s</div>
      </div>

      <div class="stat-cards">
        <div class="stat-card"><div class="sc-label">Total</div><div class="sc-val" id="sc-news-total">0</div></div>
        <div class="stat-card"><div class="sc-label">Ã‰pinglÃ©es</div><div class="sc-val" id="sc-news-pin">0</div></div>
        <div class="stat-card"><div class="sc-label">Ã€ la une</div><div class="sc-val" id="sc-news-feat">0</div></div>
      </div>

      <div class="grid-2">
        <!-- Formulaire -->
        <div>
          <div class="card">
            <div class="card-title">Ajouter une actualitÃ©</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:.7rem">
              <div class="fgroup" style="margin:0"><label class="flabel">Titre *</label><input class="finput" id="news-title" type="text" placeholder="Titre de l'actualitÃ©" required></div>
              <div class="fgroup" style="margin:0"><label class="flabel">Tag</label><input class="finput" id="news-tag" type="text" placeholder="Mise Ã  jour"></div>
            </div>
            <div class="fgroup" style="margin-top:.7rem"><label class="flabel">URL image</label><input class="finput" id="news-image" type="url" placeholder="https://..."></div>
            <div class="fgroup" style="margin-top:.7rem"><label class="flabel">Description *</label><textarea class="ftextarea" id="news-desc" required style="min-height:80px" placeholder="Contenu de l'actualitÃ©â€¦"></textarea></div>
            <button class="btn-full" style="margin-top:.5rem" onclick="addNews()">Publier l'actualitÃ©</button>
          </div>

          <div class="card" style="margin-top:1.2rem">
            <div class="card-title">AperÃ§u</div>
            <div class="preview-wrap">
              <div class="preview-img" id="prev-img">ğŸ“°</div>
              <div class="preview-body">
                <div class="preview-ptag" id="prev-tag">ActualitÃ©</div>
                <div class="preview-ptitle" id="prev-title">Titre de l'actualitÃ©</div>
                <div class="preview-pdesc" id="prev-desc">Description de l'actualitÃ©â€¦</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Liste -->
        <div class="card">
          <div class="card-title">GÃ©rer les actualitÃ©s <span style="opacity:.5;font-weight:400;font-size:.6rem">glisser pour rÃ©ordonner</span></div>
          <div class="list-area" id="news-list"></div>
        </div>
      </div>
    </section>

    <!-- â•â• STREAMERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="section" id="sec-streamers">
      <div class="page-header">
        <div class="page-eyebrow">Gestion des crÃ©ateurs</div>
        <div class="page-title">Streamers</div>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-title">Ajouter un streamer</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:.7rem">
            <div class="fgroup" style="margin:0"><label class="flabel">Nom *</label><input class="finput" id="str-name" type="text" placeholder="Pseudo" required></div>
            <div class="fgroup" style="margin:0"><label class="flabel">Plateforme</label><input class="finput" id="str-platform" type="text" placeholder="Twitch / YouTube / Kick"></div>
            <div class="fgroup" style="margin:0"><label class="flabel">Lien chaÃ®ne *</label><input class="finput" id="str-url" type="url" placeholder="https://twitch.tv/â€¦" required></div>
            <div class="fgroup" style="margin:0"><label class="flabel">Avatar (URL)</label><input class="finput" id="str-avatar" type="url" placeholder="https://â€¦"></div>
          </div>
          <button class="btn-full" style="margin-top:.75rem" onclick="addStreamer()">Ajouter le streamer</button>
        </div>

        <div class="card">
          <div class="card-title">Streamer actifs</div>
          <div class="list-area" id="str-list"></div>
        </div>
      </div>
    </section>

    <!-- â•â• ADMINS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="section" id="sec-admins">
      <div class="page-header">
        <div class="page-eyebrow">Gestion des accÃ¨s</div>
        <div class="page-title">Administrateurs</div>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-title">Ajouter localement</div>
          <div class="fgroup"><label class="flabel">ID Discord *</label><input class="finput" id="new-adm-id" type="text" placeholder="123456789012345678" required></div>
          <div class="fgroup"><label class="flabel">Pseudo *</label><input class="finput" id="new-adm-pseudo" type="text" placeholder="Pseudo Discord" required></div>
          <button class="btn-full" onclick="addAdmin()">Ajouter l'administrateur</button>
          <div class="admin-note" style="margin-top:1rem">
            La gestion des admins se fait via le bot Discord :<br>
            <code>/addadmin</code> et <code>/deleteadmin</code><br>
            L'ajout ici est local et ne synchronise pas le bot.
          </div>
        </div>

        <div class="card">
          <div class="card-title">Administrateurs</div>
          <div class="list-area" id="adm-list"></div>
        </div>
      </div>
    </section>

  </main>
</div>

<div class="toast-wrap" id="toast-wrap"></div>

<script>
// â”€â”€ DB (shared avec le site principal via localStorage) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DB = {
  get news()      { return JSON.parse(localStorage.getItem('evr_news')    || '[]'); },
  get streamers() { return JSON.parse(localStorage.getItem('evr_str')     || '[]'); },
  get admins()    { return JSON.parse(localStorage.getItem('evr_admins')  || '[]'); },
  get user()      { return JSON.parse(localStorage.getItem('evr_user')    || 'null'); },
  setNews(v)      { localStorage.setItem('evr_news',   JSON.stringify(v)); },
  setStr(v)       { localStorage.setItem('evr_str',    JSON.stringify(v)); },
  setAdmins(v)    { localStorage.setItem('evr_admins', JSON.stringify(v)); },
  setUser(v)      { localStorage.setItem('evr_user',   JSON.stringify(v)); },
  isAdmin() { const u = this.user; if (!u) return false; return this.admins.some(a => a.id === u.id); },
};

// VÃ©rification auth
window.addEventListener('DOMContentLoaded', () => {
  // RÃ©cupÃ©rer la session passÃ©e depuis le site principal
  const ses = sessionStorage.getItem('evr_admin_session');
  if (ses) {
    try {
      const data = JSON.parse(ses);
      if (data.user)      DB.setUser(data.user);
      if (data.admins)    DB.setAdmins(data.admins);
      if (data.news)      DB.setNews(data.news);
      if (data.streamers) DB.setStr(data.streamers);
    } catch {}
    sessionStorage.removeItem('evr_admin_session');
  }

  if (!DB.isAdmin()) {
    window.location.href = '../index.html';
    return;
  }
  const u = DB.user;
  document.getElementById('user-name').textContent = u?.pseudo || 'â€”';
  document.getElementById('user-avatar').src = u?.avatar || 'https://cdn.discordapp.com/embed/avatars/0.png';

  renderNews(); renderStreamers(); renderAdmins();
  initLivePrev();
  initMobileMenu();
});

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg, type = '') {
  const wrap = document.getElementById('toast-wrap');
  const t = document.createElement('div');
  t.className = `toast ${type}`; t.textContent = msg;
  wrap.appendChild(t);
  requestAnimationFrame(() => requestAnimationFrame(() => t.classList.add('in')));
  setTimeout(() => { t.classList.remove('in'); setTimeout(() => t.remove(), 350); }, 3500);
}

// â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showTab(name, el) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.snav-item').forEach(n => n.classList.remove('active'));
  document.getElementById(`sec-${name}`)?.classList.add('active');
  el?.classList.add('active');
  // fermer sidebar sur mobile
  if (window.innerWidth <= 900) closeMob();
}

// â”€â”€ MOBILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initMobileMenu() {
  document.getElementById('mob-toggle').addEventListener('click', () => {
    document.getElementById('sidebar').classList.toggle('mob-open');
    document.getElementById('sidebar-overlay').classList.toggle('show');
  });
  document.getElementById('sidebar-overlay').addEventListener('click', closeMob);
}
function closeMob() {
  document.getElementById('sidebar').classList.remove('mob-open');
  document.getElementById('sidebar-overlay').classList.remove('show');
}

// â”€â”€ LOGOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function logout() {
  DB.setUser(null);
  window.location.href = '../index.html';
}

// â”€â”€ FMT DATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmtDate(ts) { return new Date(ts).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', year: 'numeric' }); }

// â”€â”€ NEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderNews() {
  const list = document.getElementById('news-list');
  const news = [...DB.news].sort((a, b) => (a.order ?? 0) - (b.order ?? 0));
  // Stats
  document.getElementById('sc-news-total').textContent = news.length;
  document.getElementById('sc-news-pin').textContent   = news.filter(n => n.pinned).length;
  document.getElementById('sc-news-feat').textContent  = news.filter(n => n.featured).length;
  if (!news.length) { list.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ“°</div>Aucune actualitÃ© publiÃ©e</div>'; return; }
  list.innerHTML = news.map(n => `
    <div class="list-item" draggable="true" data-id="${n.id}">
      <span class="drag-handle">â ¿</span>
      <div class="list-thumb">${n.image ? `<img src="${n.image}" onerror="this.style.display='none'">` : 'ğŸ“°'}</div>
      <div class="list-info">
        <div class="list-name">${n.title}</div>
        <div class="list-meta">${fmtDate(n.ts)} ${n.tag ? `Â· <span class="tag-badge">${n.tag}</span>` : ''}</div>
      </div>
      <div class="list-actions">
        <button class="btn-icon pin ${n.pinned ? 'active' : ''}" onclick="togglePin(${n.id})" title="Ã‰pingler">ğŸ“Œ</button>
        <button class="btn-icon star ${n.featured ? 'active' : ''}" onclick="toggleFeat(${n.id})" title="Ã€ la une">â­</button>
        <button class="btn-icon del" onclick="delNews(${n.id})">âœ•</button>
      </div>
    </div>`).join('');
  initDrag(list, 'news');
}

function addNews() {
  const title = document.getElementById('news-title').value.trim();
  const desc  = document.getElementById('news-desc').value.trim();
  if (!title || !desc) { toast('Titre et description requis.', 'err'); return; }
  const news = DB.news;
  news.unshift({ id: Date.now(), title, desc, tag: document.getElementById('news-tag').value.trim() || 'ActualitÃ©', image: document.getElementById('news-image').value.trim(), ts: Date.now(), order: 0, pinned: false, featured: false });
  news.forEach((n, i) => n.order = i);
  DB.setNews(news);
  document.getElementById('news-title').value = '';
  document.getElementById('news-desc').value  = '';
  document.getElementById('news-tag').value   = '';
  document.getElementById('news-image').value = '';
  renderNews(); updatePrev(); toast('âœ“ ActualitÃ© publiÃ©e !', 'ok');
}

function togglePin(id)  { const n = DB.news, x = n.find(i => i.id === id); if (!x) return; x.pinned = !x.pinned; DB.setNews(n); renderNews(); }
function toggleFeat(id) { const n = DB.news, x = n.find(i => i.id === id); if (!x) return; x.featured = !x.featured; DB.setNews(n); renderNews(); }
function delNews(id)    { if (!confirm('Supprimer cette actualitÃ© ?')) return; DB.setNews(DB.news.filter(n => n.id !== id)); renderNews(); toast('SupprimÃ©', ''); }

// â”€â”€ LIVE PREVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initLivePrev() {
  ['news-title', 'news-desc', 'news-image', 'news-tag'].forEach(f => document.getElementById(f)?.addEventListener('input', updatePrev));
}
function updatePrev() {
  const img  = document.getElementById('news-image')?.value.trim() || '';
  const ph   = document.getElementById('prev-img');
  if (ph) ph.innerHTML = img ? `<img src="${img}" onerror="this.parentElement.innerHTML='ğŸ“°'" style="width:100%;height:140px;object-fit:cover">` : 'ğŸ“°';
  const pt = document.getElementById('prev-title'); if (pt) pt.textContent = document.getElementById('news-title')?.value || 'Titre de l\'actualitÃ©';
  const pd = document.getElementById('prev-desc');  if (pd) pd.textContent = document.getElementById('news-desc')?.value  || 'Descriptionâ€¦';
  const pT = document.getElementById('prev-tag');   if (pT) pT.textContent = document.getElementById('news-tag')?.value   || 'ActualitÃ©';
}

// â”€â”€ STREAMERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStreamers() {
  const list = document.getElementById('str-list');
  const strs = DB.streamers;
  if (!strs.length) { list.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ®</div>Aucun streamer ajoutÃ©</div>'; return; }
  list.innerHTML = strs.map(s => `
    <div class="list-item">
      <div class="list-thumb">${s.avatar ? `<img src="${s.avatar}" onerror="this.style.display='none'">` : 'ğŸ®'}</div>
      <div class="list-info">
        <div class="list-name">${s.name}</div>
        <div class="list-meta">${s.platform || 'Twitch'} Â· <a href="${s.url}" target="_blank" rel="noopener" style="color:var(--p3)">${s.url.replace('https://','')}</a></div>
      </div>
      <div class="list-actions">
        <button class="btn-icon del" onclick="delStr(${s.id})">âœ•</button>
      </div>
    </div>`).join('');
}

function addStreamer() {
  const name = document.getElementById('str-name').value.trim();
  const url  = document.getElementById('str-url').value.trim();
  if (!name || !url) { toast('Nom et lien requis.', 'err'); return; }
  const strs = DB.streamers;
  strs.push({ id: Date.now(), name, url, platform: document.getElementById('str-platform').value.trim() || 'Twitch', avatar: document.getElementById('str-avatar').value.trim(), forceLive: false });
  DB.setStr(strs);
  document.getElementById('str-name').value     = '';
  document.getElementById('str-url').value      = '';
  document.getElementById('str-platform').value = '';
  document.getElementById('str-avatar').value   = '';
  renderStreamers(); toast('âœ“ Streamer ajoutÃ© !', 'ok');
}

function delStr(id) { if (!confirm('Retirer ce streamer ?')) return; DB.setStr(DB.streamers.filter(s => s.id !== id)); renderStreamers(); toast('RetirÃ©', ''); }

// â”€â”€ ADMINS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAdmins() {
  const list   = document.getElementById('adm-list');
  const admins = DB.admins;
  const me     = DB.user?.id;
  if (!admins.length) { list.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ‘¤</div>Aucun administrateur</div>'; return; }
  list.innerHTML = admins.map(a => `
    <div class="list-item">
      <div class="list-thumb">ğŸ‘¤</div>
      <div class="list-info">
        <div class="list-name">${a.pseudo}</div>
        <div class="list-meta admin-id">${a.id}</div>
      </div>
      <div class="list-actions">
        ${a.id !== me ? `<button class="btn-icon del" onclick="delAdmin('${a.id}')">âœ•</button>` : '<span style="font-size:.7rem;color:var(--muted)">Vous</span>'}
      </div>
    </div>`).join('');
}

function addAdmin() {
  const id     = document.getElementById('new-adm-id').value.trim();
  const pseudo = document.getElementById('new-adm-pseudo').value.trim();
  if (!id || !pseudo) { toast('ID et pseudo requis.', 'err'); return; }
  const admins = DB.admins;
  if (admins.some(a => a.id === id)) { toast('Cet ID est dÃ©jÃ  admin.', 'err'); return; }
  admins.push({ id, pseudo }); DB.setAdmins(admins);
  document.getElementById('new-adm-id').value    = '';
  document.getElementById('new-adm-pseudo').value = '';
  renderAdmins(); toast('âœ“ Admin ajoutÃ© !', 'ok');
}

function delAdmin(id) {
  if (!confirm('Retirer cet administrateur ?')) return;
  DB.setAdmins(DB.admins.filter(a => a.id !== id));
  renderAdmins(); toast('Admin retirÃ©', '');
}

// â”€â”€ DRAG & DROP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initDrag(container, type) {
  let dragged = null;
  container.querySelectorAll('.list-item[draggable]').forEach(item => {
    item.addEventListener('dragstart', () => { dragged = item; setTimeout(() => item.classList.add('dragging'), 0); });
    item.addEventListener('dragend', () => { item.classList.remove('dragging'); dragged = null; saveOrder(container, type); });
    item.addEventListener('dragover', e => {
      e.preventDefault();
      if (!dragged || dragged === item) return;
      const rect = item.getBoundingClientRect();
      const mid  = rect.top + rect.height / 2;
      container.insertBefore(dragged, e.clientY < mid ? item : item.nextSibling);
    });
  });
}

function saveOrder(container, type) {
  const ids   = [...container.querySelectorAll('.list-item[data-id]')].map(el => parseInt(el.dataset.id));
  const items = DB.news;
  ids.forEach((id, i) => { const x = items.find(n => n.id === id); if (x) x.order = i; });
  DB.setNews(items);
}
</script>

</body>
</html>
