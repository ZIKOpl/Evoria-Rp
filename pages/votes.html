<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voter ‚Äî District WL</title>
  <link rel="icon" type="image/png" href="../assets/logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="../assets/css/style.css">
  <style>
    .votes-hero {
      padding-top: 80px; min-height: 38vh;
      display: flex; align-items: center; justify-content: center;
      position: relative; overflow: hidden; text-align: center;
    }
    .votes-hero-bg {
      position: absolute; inset: 0;
      background:
        radial-gradient(ellipse 80% 60% at 50% -10%, rgba(255,26,26,.18), transparent),
        radial-gradient(ellipse 50% 50% at 80% 110%, rgba(255,26,26,.15), transparent);
    }
    .votes-hero-content { position: relative; z-index: 2; padding: 3rem 1.5rem 2.5rem; }
    .votes-hero-eyebrow {
      font-size: .65rem; font-weight: 800; letter-spacing: 3px; text-transform: uppercase;
      color: var(--acc); margin-bottom: .9rem;
      display: flex; align-items: center; justify-content: center; gap: .65rem;
    }
    .votes-hero-eyebrow::before, .votes-hero-eyebrow::after {
      content: ''; display: block; width: 36px; height: 1px;
      background: linear-gradient(90deg, transparent, var(--acc));
    }
    .votes-hero-eyebrow::after { background: linear-gradient(90deg, var(--acc), transparent); }
    .votes-hero-title {
      font-family: var(--ff-title); font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 700; letter-spacing: 4px; text-transform: uppercase;
      background: linear-gradient(135deg, #fff 20%, #FF4444 60%, #FFB3B3 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; margin-bottom: .9rem; line-height: 1;
    }
    .votes-hero-sub { font-size: .88rem; color: var(--muted); max-width: 500px; margin: 0 auto 1.5rem; line-height: 1.7; }
    .votes-hero-cta {
      display: inline-flex; align-items: center; gap: .6rem;
      padding: .8rem 2rem; border-radius: 12px;
      background: linear-gradient(135deg, #FF4444, #CC0000);
      color: #fff; font-weight: 800; font-size: .88rem; letter-spacing: .5px;
      box-shadow: 0 6px 28px rgba(255,26,26,.35); border: none; cursor: pointer;
      transition: all .2s; text-decoration: none;
    }
    .votes-hero-cta:hover { filter: brightness(1.08); transform: translateY(-2px); box-shadow: 0 10px 36px rgba(255,26,26,.45); }

    .votes-main { max-width: 1000px; margin: 0 auto; padding: 2.5rem 1.5rem 5rem; display: grid; grid-template-columns: 1fr 380px; gap: 2rem; align-items: start; }
    @media (max-width: 820px) { .votes-main { grid-template-columns: 1fr; } }

    .rank-card {
      background: linear-gradient(135deg, rgba(12,0,0,.97), rgba(8,0,0,.99));
      border: 1px solid var(--border); border-radius: 20px; overflow: hidden;
    }
    .rank-header {
      padding: 1.4rem 1.6rem 1rem;
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid var(--border);
    }
    .rank-header-title {
      font-family: var(--ff-title); font-size: 1.15rem; font-weight: 700; letter-spacing: 1.5px;
      text-transform: uppercase; color: var(--text);
      display: flex; align-items: center; gap: .55rem;
    }
    .rank-header-title svg { color: var(--acc); }
    .rank-refresh {
      font-size: .68rem; color: var(--muted); display: flex; align-items: center; gap: .3rem; cursor: pointer;
      background: rgba(255,255,255,.04); border: 1px solid var(--border); border-radius: 7px;
      padding: .3rem .65rem; transition: color .2s;
    }
    .rank-refresh:hover { color: var(--text); }
    .rank-period { display: flex; gap: .4rem; padding: .9rem 1.6rem .4rem; }
    .rp-btn {
      font-size: .7rem; font-weight: 700; letter-spacing: .5px; text-transform: uppercase;
      padding: .28rem .75rem; border-radius: 7px; cursor: pointer; border: 1px solid transparent;
      background: rgba(255,255,255,.04); color: var(--muted); font-family: var(--ff-body);
      transition: all .18s;
    }
    .rp-btn.on { background: rgba(255,26,26,.12); color: var(--acc); border-color: rgba(255,26,26,.3); }
    .rp-btn:hover:not(.on) { color: var(--text); }

    .rank-list { padding: .5rem 1rem 1rem; }
    .rank-empty { text-align: center; color: var(--muted); font-size: .83rem; padding: 2.5rem 1rem; }

    .rank-item {
      display: flex; align-items: center; gap: .85rem;
      padding: .7rem .75rem; border-radius: 12px;
      transition: background .18s; cursor: default;
    }
    .rank-item:hover { background: rgba(255,255,255,.03); }
    .rank-pos {
      font-family: var(--ff-title); font-size: 1.1rem; font-weight: 700;
      min-width: 32px; text-align: center; flex-shrink: 0;
    }
    .rank-pos.p1 { color: #FFD700; text-shadow: 0 0 12px rgba(255,215,0,.5); }
    .rank-pos.p2 { color: #C0C0C0; }
    .rank-pos.p3 { color: #CD7F32; }
    .rank-pos.other { color: var(--muted); font-size: .85rem; }
    .rank-medal { font-size: 1.2rem; min-width: 24px; text-align: center; flex-shrink: 0; }
    .rank-info { flex: 1; min-width: 0; }
    .rank-name { font-size: .88rem; font-weight: 700; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .rank-votes { font-size: .7rem; color: var(--muted); }
    .rank-bar-wrap { width: 80px; flex-shrink: 0; }
    .rank-bar-bg { height: 4px; background: rgba(255,255,255,.07); border-radius: 2px; overflow: hidden; }
    .rank-bar-fill { height: 100%; border-radius: 2px; background: linear-gradient(90deg, var(--p), var(--acc)); transition: width .6s ease; }
    .rank-item:nth-child(1) .rank-bar-fill { background: linear-gradient(90deg, #FFD700, #FFA500); }
    .rank-item:nth-child(2) .rank-bar-fill { background: linear-gradient(90deg, #C0C0C0, #A0A0A0); }
    .rank-item:nth-child(3) .rank-bar-fill { background: linear-gradient(90deg, #CD7F32, #A0522D); }

    .rank-skeleton { animation: rankPulse 1.4s ease-in-out infinite; }
    .rank-skeleton-row {
      display: flex; align-items: center; gap: .85rem;
      padding: .7rem .75rem; border-radius: 12px;
    }
    .sk-circle { width: 32px; height: 32px; border-radius: 50%; background: rgba(255,255,255,.06); flex-shrink: 0; }
    .sk-block { height: 10px; border-radius: 5px; background: rgba(255,255,255,.06); }
    @keyframes rankPulse { 0%,100%{opacity:1} 50%{opacity:.5} }

    /* ‚îÄ‚îÄ Rank list mobile : top3 visible + scroll ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    @media (max-width: 820px) {
      .rank-card {
        overflow: visible;
      }
      .rank-list {
        /* Hauteur = 3 items (~66px chacun) + padding */
        max-height: 230px;
        overflow-y: auto;
        scroll-behavior: smooth;
        /* Scrollbar stylis√©e */
        scrollbar-width: thin;
        scrollbar-color: rgba(255,26,26,.4) rgba(255,255,255,.04);
      }
      .rank-list::-webkit-scrollbar {
        width: 4px;
      }
      .rank-list::-webkit-scrollbar-track {
        background: rgba(255,255,255,.04);
        border-radius: 2px;
      }
      .rank-list::-webkit-scrollbar-thumb {
        background: rgba(255,26,26,.4);
        border-radius: 2px;
      }
      .rank-list::-webkit-scrollbar-thumb:hover {
        background: rgba(255,26,26,.7);
      }
      /* Indicateur "voir plus" en bas */
      .rank-card .rank-scroll-hint {
        display: flex;
      }
    }
    @media (min-width: 821px) {
      .rank-card .rank-scroll-hint { display: none !important; }
    }
    .rank-scroll-hint {
      display: none;
      align-items: center; justify-content: center; gap: .35rem;
      padding: .55rem;
      font-size: .68rem; color: var(--muted);
      border-top: 1px solid var(--border);
      cursor: pointer;
      transition: color .2s;
    }
    .rank-scroll-hint:hover { color: var(--text); }
    .rank-scroll-hint svg { transition: transform .2s; }
    .rank-scroll-hint.expanded svg { transform: rotate(180deg); }


    .side-col { display: flex; flex-direction: column; gap: 1.25rem; }

    .vote-cta-card {
      background: linear-gradient(135deg, rgba(255,26,26,.08), rgba(255,26,26,.06));
      border: 1px solid rgba(255,26,26,.22); border-radius: 20px;
      padding: 1.6rem; text-align: center;
    }
    .vote-cta-icon { font-size: 2.8rem; margin-bottom: .75rem; }
    .vote-cta-title {
      font-family: var(--ff-title); font-size: 1.2rem; font-weight: 700; letter-spacing: 1px;
      color: var(--acc); margin-bottom: .5rem;
    }
    .vote-cta-desc { font-size: .82rem; color: var(--muted); line-height: 1.6; margin-bottom: 1.25rem; }
    .vote-cta-btn {
      display: inline-flex; align-items: center; gap: .5rem;
      width: 100%; justify-content: center;
      padding: .75rem 1.5rem; border-radius: 11px;
      background: linear-gradient(135deg, #FF4444, #CC0000);
      color: #fff; font-weight: 800; font-size: .85rem;
      border: none; cursor: pointer; transition: all .2s; text-decoration: none;
    }
    .vote-cta-btn:hover { filter: brightness(1.08); transform: translateY(-1px); }
    .vote-cta-timer { font-size: .7rem; color: var(--muted); margin-top: .6rem; }

    .reminder-card {
      background: linear-gradient(135deg, rgba(255,26,26,.08), rgba(10,0,0,.95));
      border: 1px solid rgba(255,26,26,.25); border-radius: 20px; padding: 1.6rem;
    }
    .reminder-title {
      font-family: var(--ff-title); font-size: 1rem; font-weight: 700; letter-spacing: 1px;
      color: var(--text); margin-bottom: .4rem;
      display: flex; align-items: center; gap: .5rem;
    }
    .reminder-title svg { color: #FF4444; }
    .reminder-desc { font-size: .78rem; color: var(--muted); line-height: 1.6; margin-bottom: 1rem; }
    .reminder-form { display: flex; flex-direction: column; gap: .55rem; }
    .reminder-input {
      width: 100%; background: rgba(255,255,255,.04); border: 1px solid rgba(255,26,26,.25);
      border-radius: 9px; padding: .6rem .85rem;
      font-family: var(--ff-body); font-size: .82rem; color: var(--text);
      outline: none; transition: border-color .2s;
    }
    .reminder-input:focus { border-color: rgba(255,26,26,.6); background: rgba(255,26,26,.05); }
    .reminder-input::placeholder { color: var(--muted); }
    .reminder-btn-add {
      width: 100%; padding: .65rem; border-radius: 9px; border: none; cursor: pointer;
      background: rgba(255,26,26,.15); color: #FF4444;
      font-family: var(--ff-body); font-size: .82rem; font-weight: 700;
      border: 1px solid rgba(255,26,26,.3); transition: all .2s;
      display: flex; align-items: center; justify-content: center; gap: .4rem;
    }
    .reminder-btn-add:hover { background: rgba(255,26,26,.25); }
    .reminder-sep { display: flex; align-items: center; gap: .5rem; color: var(--muted); font-size: .7rem; }
    .reminder-sep::before, .reminder-sep::after { content: ''; flex: 1; height: 1px; background: var(--border); }
    .reminder-btn-del {
      width: 100%; padding: .6rem; border-radius: 9px; cursor: pointer;
      background: rgba(248,113,113,.07); color: var(--red);
      font-family: var(--ff-body); font-size: .78rem; font-weight: 700;
      border: 1px solid rgba(248,113,113,.2); transition: all .2s;
    }
    .reminder-btn-del:hover { background: rgba(248,113,113,.15); }
    .reminder-note { font-size: .68rem; color: var(--muted); text-align: center; line-height: 1.5; margin-top: .4rem; }

    .vstats-card {
      background: linear-gradient(135deg, rgba(12,0,0,.97), rgba(8,0,0,.99));
      border: 1px solid var(--border); border-radius: 20px; padding: 1.4rem 1.6rem;
    }
    .vstats-title {
      font-size: .68rem; font-weight: 800; letter-spacing: 1.5px; text-transform: uppercase;
      color: var(--p3); margin-bottom: 1rem; display: flex; align-items: center; gap: .5rem;
    }
    .vstats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; }
    .vstat-item { text-align: center; }
    .vstat-val {
      font-family: var(--ff-title); font-size: 1.8rem; font-weight: 700; color: var(--text); line-height: 1;
    }
    .vstat-label { font-size: .68rem; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; margin-top: .2rem; }

    .howto-card {
      background: linear-gradient(135deg, rgba(12,0,0,.97), rgba(8,0,0,.99));
      border: 1px solid var(--border); border-radius: 20px; padding: 1.4rem 1.6rem;
    }
    .howto-title {
      font-size: .68rem; font-weight: 800; letter-spacing: 1.5px; text-transform: uppercase;
      color: var(--p3); margin-bottom: 1rem;
    }
    .howto-steps { display: flex; flex-direction: column; gap: .7rem; }
    .howto-step { display: flex; align-items: flex-start; gap: .75rem; }
    .howto-num {
      width: 24px; height: 24px; border-radius: 50%; flex-shrink: 0;
      background: rgba(255,26,26,.2); border: 1px solid rgba(255,26,26,.35);
      font-size: .7rem; font-weight: 800; color: var(--acc);
      display: flex; align-items: center; justify-content: center;
    }
    .howto-text { font-size: .8rem; color: var(--muted); line-height: 1.5; padding-top: 3px; }
    .howto-text strong { color: var(--text); }

    @media (max-width: 480px) {
      .rank-bar-wrap { display: none; }
      .votes-hero-content { padding: 2.5rem 1rem 2rem; }
    }

    /* ‚îÄ‚îÄ Reminder card OAuth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .reminder-user-bar {
      display: flex; align-items: center; gap: .75rem;
      padding: .65rem .85rem;
      background: rgba(255,26,26,.08);
      border: 1px solid rgba(255,26,26,.25);
      border-radius: 10px;
      margin-bottom: .75rem;
    }
    .reminder-user-bar img {
      width: 36px; height: 36px; border-radius: 50%;
      border: 2px solid rgba(255,26,26,.4);
      object-fit: cover; flex-shrink: 0;
    }
    .reminder-user-bar .rub-name { font-size: .88rem; font-weight: 600; color: var(--text); }
    .reminder-user-bar .rub-tag  { font-size: .72rem; color: var(--muted); }
    .reminder-user-bar .rub-actions { margin-left: auto; display: flex; gap: .5rem; }
    .rub-logout { font-size: .7rem; color: var(--muted); cursor: pointer; background: none; border: 1px solid var(--border); border-radius: 6px; padding: .2rem .5rem; }
    .rub-logout:hover { color: var(--red); border-color: rgba(248,113,113,.3); }
    .reminder-subscribed-badge {
      display: flex; align-items: center; gap: .5rem;
      padding: .55rem .85rem;
      background: rgba(74,222,128,.08);
      border: 1px solid rgba(74,222,128,.2);
      border-radius: 8px;
      font-size: .8rem; color: #4ADE80;
      margin-bottom: .65rem;
    }
    .btn-discord-connect {
      display: flex; align-items: center; justify-content: center; gap: .6rem;
      width: 100%; padding: .7rem 1rem;
      background: linear-gradient(135deg, #FF1A1A, #CC0000); color: #fff;
      border: none; border-radius: 10px; cursor: pointer;
      font-size: .88rem; font-weight: 600;
      transition: background .2s, transform .1s;
    }
    .btn-discord-connect:hover { background: #AA0000; transform: translateY(-1px); }
    .btn-discord-connect:active { transform: translateY(0); }
  </style>
</head>
<body>

<nav class="navbar" id="navbar">
  <a href="../index.html" class="nav-logo">
    <img src="../assets/logo.png" alt="District WL"
      onerror="this.outerHTML='<span style=&quot;font-family:var(--ff-title);font-size:1.3rem;font-weight:700;letter-spacing:3px;background:linear-gradient(135deg,#FF4444,#FFB3B3);-webkit-background-clip:text;-webkit-text-fill-color:transparent&quot;>DISTRICT WL</span>'">
  </a>
  <ul class="nav-links" id="nav-links">
    <li><a data-boutique href="#" target="_blank" rel="noopener">Boutique</a></li>
    <li><a data-reglement href="#" target="_blank" rel="noopener">R√®glement</a></li>
    <li><a href="votes.html">Voter</a></li>
    <li><a href="streamers.html">Streamers</a></li>
    <li><a href="whitelist.html">Whitelist</a></li>
    <li class="nav-drop">
      <a href="#">Support <svg width="10" height="6" viewBox="0 0 11 7" fill="none"><path d="M1 1l4.5 4.5L10 1" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
      <div class="drop-menu">
        <a href="#" id="btn-aide">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          Aide
        </a>
        <a href="#" id="btn-admin">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          Admin
        </a>
      </div>
    </li>
    <li id="nav-join-btn">
      <a data-discord href="#" target="_blank" rel="noopener" class="btn-join">
        <svg width="16" height="12" viewBox="0 0 71 55" fill="currentColor"><path d="M60.1 4.9A58.6 58.6 0 0 0 45.7 0a.22.22 0 0 0-.23.11 40.8 40.8 0 0 0-1.8 3.7c-5.46-.82-10.89-.82-16.23 0-.48-1.16-1.2-2.59-1.82-3.7a.23.23 0 0 0-.23-.11A58.4 58.4 0 0 0 10.9 4.9a.21.21 0 0 0-.1.08C1.58 18.73-.94 32.14.29 45.39a.24.24 0 0 0 .09.17c6.07 4.46 11.96 7.17 17.73 8.96a.23.23 0 0 0 .25-.08 42.1 42.1 0 0 0 3.63-5.9.22.22 0 0 0-.12-.31 38.8 38.8 0 0 1-5.54-2.64.23.23 0 0 1-.02-.38c.37-.28.74-.57 1.1-.86a.22.22 0 0 1 .23-.03c11.61 5.3 24.17 5.3 35.65 0a.22.22 0 0 1 .23.03c.36.29.73.58 1.1.86a.23.23 0 0 1-.02.38 36.4 36.4 0 0 1-5.54 2.64.23.23 0 0 0-.12.31 47.2 47.2 0 0 0 3.62 5.9.22.22 0 0 0 .25.08c5.8-1.79 11.68-4.5 17.76-8.96a.23.23 0 0 0 .09-.16c1.48-15.32-2.48-28.62-10.5-40.41a.18.18 0 0 0-.09-.09ZM23.73 37.33c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Zm23.59 0c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Z"/></svg>
        Nous rejoindre
      </a>
    </li>
  </ul>
  <button class="burger" id="burger" aria-label="Menu"><span></span><span></span><span></span></button>
</nav>

<div class="mobile-menu" id="mobile-menu">
  <a data-boutique href="#" target="_blank" rel="noopener">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
    Boutique
  </a>
  <a data-reglement href="#" target="_blank" rel="noopener">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
    R√®glement
  </a>
  <a href="votes.html" class="active">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M9 12l2 2 4-4"/><rect x="3" y="3" width="18" height="18" rx="3"/></svg>
    Voter
  </a>
  <a href="streamers.html">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.95-1.96C18.88 4 12 4 12 4s-6.88 0-8.59.46A2.78 2.78 0 0 0 1.46 6.42 29 29 0 0 0 1 12a29 29 0 0 0 .46 5.58 2.78 2.78 0 0 0 1.95 1.96C5.12 20 12 20 12 20s6.88 0 8.59-.46a2.78 2.78 0 0 0 1.95-1.96A29 29 0 0 0 23 12a29 29 0 0 0-.46-5.58z"/><polygon points="9.75 15.02 15.5 12 9.75 8.98 9.75 15.02"/></svg>
    Streamers
  </a>
  <a href="whitelist.html">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
    Whitelist
  </a>
  <div class="mm-sep"></div>
  <a href="#" id="mm-aide">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
    Aide
  </a>
  <a href="#" id="mm-admin">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
    Espace Admin
  </a>
  <div class="mm-sep"></div>
  <a data-discord href="#" target="_blank" rel="noopener" class="mm-discord">
    <svg width="18" height="14" viewBox="0 0 71 55" fill="currentColor"><path d="M60.1 4.9A58.6 58.6 0 0 0 45.7 0a.22.22 0 0 0-.23.11 40.8 40.8 0 0 0-1.8 3.7c-5.46-.82-10.89-.82-16.23 0-.48-1.16-1.2-2.59-1.82-3.7a.23.23 0 0 0-.23-.11A58.4 58.4 0 0 0 10.9 4.9a.21.21 0 0 0-.1.08C1.58 18.73-.94 32.14.29 45.39a.24.24 0 0 0 .09.17c6.07 4.46 11.96 7.17 17.73 8.96a.23.23 0 0 0 .25-.08 42.1 42.1 0 0 0 3.63-5.9.22.22 0 0 0-.12-.31 38.8 38.8 0 0 1-5.54-2.64.23.23 0 0 1-.02-.38c.37-.28.74-.57 1.1-.86a.22.22 0 0 1 .23-.03c11.61 5.3 24.17 5.3 35.65 0a.22.22 0 0 1 .23.03c.36.29.73.58 1.1.86a.23.23 0 0 1-.02.38 36.4 36.4 0 0 1-5.54 2.64.23.23 0 0 0-.12.31 47.2 47.2 0 0 0 3.62 5.9.22.22 0 0 0 .25.08c5.8-1.79 11.68-4.5 17.76-8.96a.23.23 0 0 0 .09-.16c1.48-15.32-2.48-28.62-10.5-40.41a.18.18 0 0 0-.09-.09ZM23.73 37.33c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Zm23.59 0c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Z"/></svg>
    Rejoindre le Discord
  </a>
</div>

<div class="votes-hero">
  <div class="votes-hero-bg"></div>
  <div class="votes-hero-content">
    <div class="votes-hero-eyebrow">Top-Serveurs.net</div>
    <h1 class="votes-hero-title">VOTEZ POUR NOUS</h1>
    <p class="votes-hero-sub">Chaque vote aide District WL √† grimper dans le classement et √† √™tre d√©couvert par de nouveaux joueurs. Votez toutes les 2h !</p>
    <a id="hero-vote-btn" data-topserveur href="#" target="_blank" rel="noopener" class="votes-hero-cta">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
      Voter maintenant
    </a>
  </div>
</div>

<div class="votes-main">

  <div class="rank-card">
    <div class="rank-header">
      <div class="rank-header-title">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        Classement des voteurs
      </div>
      <button class="rank-refresh" onclick="loadRanking()" id="refresh-btn">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
        Actualiser
      </button>
    </div>
    <div class="rank-period">
      <button class="rp-btn on" id="btn-current" onclick="switchPeriod('current')">Ce mois-ci</button>
      <button class="rp-btn" id="btn-last" onclick="switchPeriod('lastMonth')">Mois dernier</button>
    </div>
    <div class="rank-list" id="rank-list">

      <div class="rank-skeleton" id="rank-skeleton">
        ${[...Array(10)].map(() => `
        <div class="rank-skeleton-row">
          <div class="sk-block" style="width:28px;height:14px;border-radius:4px"></div>
          <div class="sk-circle"></div>
          <div style="flex:1;display:flex;flex-direction:column;gap:6px">
            <div class="sk-block" style="width:55%;"></div>
            <div class="sk-block" style="width:30%;height:8px;"></div>
          </div>
          <div class="sk-block" style="width:60px;height:4px;"></div>
        </div>`).join('')}
      </div>
    </div>
    <div class="rank-scroll-hint" id="rank-scroll-hint" onclick="toggleRankScroll()">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      Voir tous les joueurs
    </div>
  </div>

  <div class="side-col">

    <div class="reminder-card" id="reminder-card">
      <div class="reminder-title">
        <svg width="18" height="14" viewBox="0 0 71 55" fill="currentColor"><path d="M60.1 4.9A58.6 58.6 0 0 0 45.7 0a.22.22 0 0 0-.23.11 40.8 40.8 0 0 0-1.8 3.7c-5.46-.82-10.89-.82-16.23 0-.48-1.16-1.2-2.59-1.82-3.7a.23.23 0 0 0-.23-.11A58.4 58.4 0 0 0 10.9 4.9a.21.21 0 0 0-.1.08C1.58 18.73-.94 32.14.29 45.39a.24.24 0 0 0 .09.17c6.07 4.46 11.96 7.17 17.73 8.96a.23.22 0 0 0 .25-.08 42.1 42.1 0 0 0 3.63-5.9.22.22 0 0 0-.12-.31 38.8 38.8 0 0 1-5.54-2.64.23.23 0 0 1-.02-.38c.37-.28.74-.57 1.1-.86a.22.22 0 0 1 .23-.03c11.61 5.3 24.17 5.3 35.65 0a.22.22 0 0 1 .23.03c.36.29.73.58 1.1.86a.23.23 0 0 1-.02.38 36.4 36.4 0 0 1-5.54 2.64.23.22 0 0 0-.12.31 47.2 47.2 0 0 0 3.62 5.9.22.22 0 0 0 .25.08c5.8-1.79 11.68-4.5 17.76-8.96a.23.23 0 0 0 .09-.16c1.48-15.32-2.48-28.62-10.5-40.41a.18.18 0 0 0-.09-.09ZM23.73 37.33c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Zm23.59 0c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Z"/></svg>
        Rappel Discord
      </div>
      <div class="reminder-desc">Le bot t'envoie un DM toutes les 2h pour te rappeler de voter.</div>

      <!-- √âtat : non connect√© -->
      <div id="reminder-state-login">
        <div style="display:flex;gap:.5rem;align-items:flex-start;background:rgba(255,26,26,.08);border:1px solid rgba(255,26,26,.2);border-radius:8px;padding:.6rem .75rem;margin-bottom:.75rem;font-size:.75rem;color:#FF4444;line-height:1.5">
          <span style="font-size:1rem;flex-shrink:0">‚ö†Ô∏è</span>
          <span>Active les DM du bot avant de t'inscrire :<br><strong>Param√®tres ‚Üí Confidentialit√© ‚Üí "Messages priv√©s des membres du serveur" ‚Üí ON</strong></span>
        </div>
        <button class="btn-discord-connect" onclick="loginForReminder()">
          <svg width="18" height="14" viewBox="0 0 71 55" fill="currentColor"><path d="M60.1 4.9A58.6 58.6 0 0 0 45.7 0a.22.22 0 0 0-.23.11 40.8 40.8 0 0 0-1.8 3.7c-5.46-.82-10.89-.82-16.23 0-.48-1.16-1.2-2.59-1.82-3.7a.23.23 0 0 0-.23-.11A58.4 58.4 0 0 0 10.9 4.9a.21.21 0 0 0-.1.08C1.58 18.73-.94 32.14.29 45.39a.24.24 0 0 0 .09.17c6.07 4.46 11.96 7.17 17.73 8.96a.23.22 0 0 0 .25-.08 42.1 42.1 0 0 0 3.63-5.9.22.22 0 0 0-.12-.31 38.8 38.8 0 0 1-5.54-2.64.23.23 0 0 1-.02-.38c.37-.28.74-.57 1.1-.86a.22.22 0 0 1 .23-.03c11.61 5.3 24.17 5.3 35.65 0a.22.22 0 0 1 .23.03c.36.29.73.58 1.1.86a.23.23 0 0 1-.02.38 36.4 36.4 0 0 1-5.54 2.64.23.22 0 0 0-.12.31 47.2 47.2 0 0 0 3.62 5.9.22.22 0 0 0 .25.08c5.8-1.79 11.68-4.5 17.76-8.96a.23.23 0 0 0 .09-.16c1.48-15.32-2.48-28.62-10.5-40.41a.18.18 0 0 0-.09-.09ZM23.73 37.33c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Zm23.59 0c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Z"/></svg>
          Se connecter avec Discord
        </button>
      </div>

      <!-- √âtat : connect√© -->
      <div id="reminder-state-connected" style="display:none">
        <!-- Profil utilisateur -->
        <div class="reminder-user-bar">
          <img id="reminder-user-avatar" src="" alt="Avatar" onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'">
          <div>
            <div class="rub-name" id="reminder-user-name">‚Äî</div>
            <div class="rub-tag">Connect√© via Discord</div>
          </div>
          <div class="rub-actions">
            <button class="rub-logout" onclick="logoutReminder()">Changer de compte</button>
          </div>
        </div>
        <!-- Badge si d√©j√† inscrit -->
        <div class="reminder-subscribed-badge" id="reminder-already-badge" style="display:none">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
          Tu es inscrit aux rappels toutes les 2h üîî
        </div>
        <!-- Boutons action -->
        <div class="reminder-form" style="margin-top:.5rem">
          <button class="reminder-btn-add" id="btn-subscribe-reminder" onclick="subscribeReminder()" style="display:none">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            Activer les rappels
          </button>
          <button class="reminder-btn-del" id="btn-unsubscribe-reminder" onclick="unsubscribeReminder()" style="display:none">
            üîï Se d√©sinscrire des rappels
          </button>
        </div>
      </div>

    </div>

    <div class="vstats-card">
      <div class="vstats-title">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        Stats ce mois-ci
      </div>
      <div class="vstats-grid">
        <div class="vstat-item">
          <div class="vstat-val" id="stat-total-votes">‚Äî</div>
          <div class="vstat-label">votes totaux</div>
        </div>
        <div class="vstat-item">
          <div class="vstat-val" id="stat-top-votes">‚Äî</div>
          <div class="vstat-label">meilleur voteur</div>
        </div>
      </div>
    </div>

    <div class="howto-card">
      <div class="howto-title">Comment voter ?</div>
      <div class="howto-steps">
        <div class="howto-step">
          <div class="howto-num">1</div>
          <div class="howto-text">Clique sur <strong>Voter maintenant</strong> ci-dessus</div>
        </div>
        <div class="howto-step">
          <div class="howto-num">2</div>
          <div class="howto-text">Entre ton <strong>pseudo en jeu</strong> sur Top-Serveurs.net</div>
        </div>
        <div class="howto-step">
          <div class="howto-num">3</div>
          <div class="howto-text">Valide le captcha et clique sur <strong>Voter</strong></div>
        </div>
        <div class="howto-step">
          <div class="howto-num">4</div>
          <div class="howto-text">Tu peux voter √† nouveau <strong>toutes les 2 heures</strong> !</div>
        </div>
      </div>
    </div>

  </div>
</div>

<footer>
  <div class="footer-logo">DISTRICT WL</div>
  <nav class="footer-nav">
    <a href="../index.html">Accueil</a>
    <a data-boutique href="#">Boutique</a>
    <a data-reglement href="#">R√®glement</a>
    <a href="votes.html">Voter</a>
    <a data-discord href="#" target="_blank">Discord</a>
  </nav>
  <p class="footer-copy">¬© 2026 District WL ‚Äî Tous droits r√©serv√©s</p>
</footer>



<div class="modal-overlay" id="modal-aide">
  <div class="modal" style="max-width:480px">
    <button class="modal-x">‚úï</button>
    <div class="modal-title">BESOIN D'AIDE ?</div>
    <p class="modal-sub">Une question, un probl√®me ou une demande ?</p>
    <div style="text-align:center;padding:1.5rem 0 .5rem">
      <div style="width:72px;height:72px;border-radius:50%;background:rgba(88,101,242,.15);border:1px solid rgba(88,101,242,.3);display:flex;align-items:center;justify-content:center;margin:0 auto 1.25rem">
        <svg width="36" height="28" viewBox="0 0 71 55" fill="#7289da"><path d="M60.1 4.9A58.6 58.6 0 0 0 45.7 0a.22.22 0 0 0-.23.11 40.8 40.8 0 0 0-1.8 3.7c-5.46-.82-10.89-.82-16.23 0-.48-1.16-1.2-2.59-1.82-3.7a.23.23 0 0 0-.23-.11A58.4 58.4 0 0 0 10.9 4.9a.21.21 0 0 0-.1.08C1.58 18.73-.94 32.14.29 45.39a.24.24 0 0 0 .09.17c6.07 4.46 11.96 7.17 17.73 8.96a.23.23 0 0 0 .25-.08 42.1 42.1 0 0 0 3.63-5.9.22.22 0 0 0-.12-.31 38.8 38.8 0 0 1-5.54-2.64.23.23 0 0 1-.02-.38c.37-.28.74-.57 1.1-.86a.22.22 0 0 1 .23-.03c11.61 5.3 24.17 5.3 35.65 0a.22.22 0 0 1 .23.03c.36.29.73.58 1.1.86a.23.23 0 0 1-.02.38 36.4 36.4 0 0 1-5.54 2.64.23.23 0 0 0-.12.31 47.2 47.2 0 0 0 3.62 5.9.22.22 0 0 0 .25.08c5.8-1.79 11.68-4.5 17.76-8.96a.23.23 0 0 0 .09-.16c1.48-15.32-2.48-28.62-10.5-40.41a.18.18 0 0 0-.09-.09ZM23.73 37.33c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Zm23.59 0c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Z"/></svg>
      </div>
      <p style="font-size:.92rem;color:var(--text);line-height:1.7;margin-bottom:.5rem">Pour toute question ou demande, rejoignez notre serveur Discord et ouvrez un <strong style="color:var(--p3)">ticket</strong> dans le salon d√©di√©.</p>
      <p style="font-size:.82rem;color:var(--muted);margin-bottom:1.75rem">Notre √©quipe vous r√©pondra dans les meilleurs d√©lais.</p>
      <a data-discord href="#" target="_blank" rel="noopener" class="btn-discord-oauth" style="text-decoration:none">
        <svg width="20" height="15" viewBox="0 0 71 55" fill="currentColor"><path d="M60.1 4.9A58.6 58.6 0 0 0 45.7 0a.22.22 0 0 0-.23.11 40.8 40.8 0 0 0-1.8 3.7c-5.46-.82-10.89-.82-16.23 0-.48-1.16-1.2-2.59-1.82-3.7a.23.23 0 0 0-.23-.11A58.4 58.4 0 0 0 10.9 4.9a.21.21 0 0 0-.1.08C1.58 18.73-.94 32.14.29 45.39a.24.24 0 0 0 .09.17c6.07 4.46 11.96 7.17 17.73 8.96a.23.23 0 0 0 .25-.08 42.1 42.1 0 0 0 3.63-5.9.22.22 0 0 0-.12-.31 38.8 38.8 0 0 1-5.54-2.64.23.23 0 0 1-.02-.38c.37-.28.74-.57 1.1-.86a.22.22 0 0 1 .23-.03c11.61 5.3 24.17 5.3 35.65 0a.22.22 0 0 1 .23.03c.36.29.73.58 1.1.86a.23.23 0 0 1-.02.38 36.4 36.4 0 0 1-5.54 2.64.23.23 0 0 0-.12.31 47.2 47.2 0 0 0 3.62 5.9.22.22 0 0 0 .25.08c5.8-1.79 11.68-4.5 17.76-8.96a.23.23 0 0 0 .09-.16c1.48-15.32-2.48-28.62-10.5-40.41a.18.18 0 0 0-.09-.09ZM23.73 37.33c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Zm23.59 0c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Z"/></svg>
        Nous rejoindre sur Discord
      </a>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-admin-login">
  <div class="modal" style="max-width:420px">
    <button class="modal-x">‚úï</button>
    <div class="modal-title">ESPACE ADMIN</div>
    <p class="modal-sub">Connectez-vous avec votre compte Discord</p>
    <button id="btn-discord-login" class="btn-discord-oauth">
      <svg width="20" height="15" viewBox="0 0 71 55" fill="currentColor"><path d="M60.1 4.9A58.6 58.6 0 0 0 45.7 0a.22.22 0 0 0-.23.11 40.8 40.8 0 0 0-1.8 3.7c-5.46-.82-10.89-.82-16.23 0-.48-1.16-1.2-2.59-1.82-3.7a.23.23 0 0 0-.23-.11A58.4 58.4 0 0 0 10.9 4.9a.21.21 0 0 0-.1.08C1.58 18.73-.94 32.14.29 45.39a.24.24 0 0 0 .09.17c6.07 4.46 11.96 7.17 17.73 8.96a.23.23 0 0 0 .25-.08 42.1 42.1 0 0 0 3.63-5.9.22.22 0 0 0-.12-.31 38.8 38.8 0 0 1-5.54-2.64.23.23 0 0 1-.02-.38c.37-.28.74-.57 1.1-.86a.22.22 0 0 1 .23-.03c11.61 5.3 24.17 5.3 35.65 0a.22.22 0 0 1 .23.03c.36.29.73.58 1.1.86a.23.23 0 0 1-.02.38 36.4 36.4 0 0 1-5.54 2.64.23.23 0 0 0-.12.31 47.2 47.2 0 0 0 3.62 5.9.22.22 0 0 0 .25.08c5.8-1.79 11.68-4.5 17.76-8.96a.23.23 0 0 0 .09-.16c1.48-15.32-2.48-28.62-10.5-40.41a.18.18 0 0 0-.09-.09ZM23.73 37.33c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Zm23.59 0c-3.5 0-6.38-3.21-6.38-7.16s2.83-7.16 6.38-7.16c3.58 0 6.44 3.24 6.38 7.16 0 3.95-2.83 7.16-6.38 7.16Z"/></svg>
      Se connecter avec Discord
    </button>
  </div>
</div>

<div class="toast-wrap" id="toast-wrap"></div>

<script src="../config.js"></script>
<script src="../assets/js/script.js"></script>
<script>
let _rankPeriod = 'current';

// loadRanking appel√© dans le bloc DOMContentLoaded unifi√© ci-dessous

function switchPeriod(p) {
  _rankPeriod = p;
  document.getElementById('btn-current').classList.toggle('on', p === 'current');
  document.getElementById('btn-last').classList.toggle('on', p === 'lastMonth');
  loadRanking();
}

async function loadRanking() {
  const list = document.getElementById('rank-list');
  const btn  = document.getElementById('refresh-btn');
  if (btn) btn.style.opacity = '.5';

  list.innerHTML = `<div class="rank-skeleton">${[...Array(10)].map(() => `
    <div class="rank-skeleton-row">
      <div class="sk-block" style="width:28px;height:14px;border-radius:4px"></div>
      <div class="sk-circle"></div>
      <div style="flex:1;display:flex;flex-direction:column;gap:6px">
        <div class="sk-block" style="width:55%;"></div>
        <div class="sk-block" style="width:30%;height:8px;"></div>
      </div>
      <div class="sk-block" style="width:60px;height:4px;"></div>
    </div>`).join('')}</div>`;

  const res = await apiFetch(`/api/votes/ranking?period=${_rankPeriod}`);
  if (btn) btn.style.opacity = '1';

  if (!res || !res.ok) {
    list.innerHTML = '<div class="rank-empty">Impossible de charger le classement.<br><span style="font-size:.75rem">V√©rifiez que le token TopServeur est configur√© dans le bot.</span></div>';
    return;
  }

  const data = await res.json();
  const players = data.players || [];

  if (!players.length) {
    list.innerHTML = '<div class="rank-empty">Aucun vote ce mois-ci.<br><span style="font-size:.75rem">Soyez le premier √† voter !</span></div>';
    return;
  }

  const maxVotes = players[0]?.votes || 1;
  const medals = ['ü•á', 'ü•à', 'ü•â'];

  const totalVotes = players.reduce((s, p) => s + (p.votes || 0), 0);
  const elT = document.getElementById('stat-total-votes');
  const elB = document.getElementById('stat-top-votes');
  if (elT) animNum(elT, totalVotes, 900);
  if (elB) animNum(elB, maxVotes, 900);

  list.innerHTML = players.slice(0, 10).map((p, i) => {
    const pct = Math.round((p.votes / maxVotes) * 100);
    const posClass = i === 0 ? 'p1' : i === 1 ? 'p2' : i === 2 ? 'p3' : 'other';
    return `<div class="rank-item">
      <div class="rank-pos ${posClass}">${i < 3 ? medals[i] : i + 1}</div>
      <div class="rank-info">
        <div class="rank-name">${escHtml(p.playername || p.username || '‚Äî')}</div>
        <div class="rank-votes">${p.votes} vote${p.votes > 1 ? 's' : ''}</div>
      </div>
      <div class="rank-bar-wrap">
        <div class="rank-bar-bg"><div class="rank-bar-fill" style="width:${pct}%"></div></div>
      </div>
    </div>`;
  }).join('');
}

function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}


// ‚îÄ‚îÄ Rank list mobile expand/collapse ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleRankScroll() {
  const list = document.getElementById('rank-list');
  const hint = document.getElementById('rank-scroll-hint');
  if (!list || !hint) return;
  const isExpanded = hint.classList.contains('expanded');
  if (isExpanded) {
    list.style.maxHeight = '';
    hint.classList.remove('expanded');
    hint.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg> Voir tous les joueurs`;
  } else {
    list.style.maxHeight = '600px';
    hint.classList.add('expanded');
    hint.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg> R√©duire`;
  }
}
// ‚îÄ‚îÄ SYST√àME RAPPELS OAUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// Session partag√©e ‚Äî cl√© d√©finie dans script.js (SHARED_USER_KEY = 'district_user')
// On utilise directement la string pour √©viter la red√©claration

function getReminderUser() {
  try {
    return JSON.parse(localStorage.getItem('district_user') || localStorage.getItem('district_reminder_user') || 'null');
  } catch { return null; }
}
function setReminderUser(user) {
  localStorage.setItem('district_user', JSON.stringify(user));
  localStorage.setItem('district_reminder_user', JSON.stringify(user)); // r√©trocompat
}
function clearReminderUser() {
  localStorage.removeItem('district_user');
  localStorage.removeItem('district_reminder_user');
}

function loginForReminder() {
  const clientId = (typeof CONFIG !== 'undefined') ? CONFIG.discordOAuthClientID : '';
  const redirectUri = (typeof CONFIG !== 'undefined') ? CONFIG.discordOAuthRedirectURI : '';
  if (!clientId) { toast('OAuth non configur√©.', 'err'); return; }
  const params = new URLSearchParams({
    client_id: clientId,
    redirect_uri: redirectUri,
    response_type: 'code',
    scope: 'identify',
    state: 'votes'  // indique au callback de revenir sur votes.html
  });
  window.location.href = `https://discord.com/oauth2/authorize?${params}`;
}

function logoutReminder() {
  clearReminderUser();
  renderReminderCard();
}

async function renderReminderCard() {
  const user = getReminderUser();
  const stateLogin     = document.getElementById('reminder-state-login');
  const stateConnected = document.getElementById('reminder-state-connected');
  if (!user || !user.id) {
    stateLogin.style.display = '';
    stateConnected.style.display = 'none';
    return;
  }
  // Connect√© ‚Äî afficher le profil
  stateLogin.style.display = 'none';
  stateConnected.style.display = '';
  document.getElementById('reminder-user-avatar').src = user.avatar || 'https://cdn.discordapp.com/embed/avatars/0.png';
  document.getElementById('reminder-user-name').textContent = user.pseudo || user.id;
  // V√©rifier si d√©j√† inscrit
  const badge   = document.getElementById('reminder-already-badge');
  const btnSub  = document.getElementById('btn-subscribe-reminder');
  const btnUnsub= document.getElementById('btn-unsubscribe-reminder');
  try {
    const res  = await apiFetch(`/api/vote-reminders/status?discordId=${user.id}`);
    const data = res && res.ok ? await res.json() : { subscribed: false };
    if (data.subscribed) {
      badge.style.display = 'flex';
      btnSub.style.display = 'none';
      btnUnsub.style.display = '';
    } else {
      badge.style.display = 'none';
      btnSub.style.display = '';
      btnUnsub.style.display = 'none';
    }
  } catch { btnSub.style.display = ''; btnUnsub.style.display = 'none'; }
}

async function subscribeReminder() {
  const user = getReminderUser();
  if (!user?.id) { toast('Connecte-toi d\'abord.', 'err'); return; }
  const res = await apiFetch('/api/vote-reminders', { method: 'POST', body: JSON.stringify({ discordId: user.id }) });
  if (!res || !res.ok) { toast('Erreur ‚Äî v√©rifie que le bot est en ligne.', 'err'); return; }
  const d = await res.json();
  if (d.already) { toast('Tu es d√©j√† inscrit !', ''); }
  else { toast('Rappels activ√©s ! Tu recevras un DM toutes les 2h üîî', 'ok'); }
  renderReminderCard();
}

async function unsubscribeReminder() {
  const user = getReminderUser();
  if (!user?.id) { toast('Connecte-toi d\'abord.', 'err'); return; }
  const res = await apiFetch(`/api/vote-reminders?discordId=${user.id}`, { method: 'DELETE' });
  if (!res || !res.ok) { toast('Erreur ‚Äî v√©rifie que le bot est en ligne.', 'err'); return; }
  const d = await res.json();
  if (!d.removed) { toast('Tu n\'√©tais pas inscrit.', ''); }
  else { toast('Rappels d√©sactiv√©s üîï', 'ok'); }
  renderReminderCard();
}

// G√©rer le retour OAuth depuis votes.html
function handleVotesOAuthCallback() {
  const params = new URLSearchParams(window.location.search);
  if (!params.has('discord_id') && !params.has('auth_error')) return;
  history.replaceState({}, '', window.location.pathname);
  if (params.get('auth_error')) { toast('Erreur de connexion Discord.', 'err'); return; }
  const user = {
    id:     params.get('discord_id'),
    pseudo: params.get('global_name') || params.get('discord_pseudo'),
    avatar: params.get('discord_avatar')
  };
  setReminderUser(user); // sauvegarde dans la cl√© partag√©e
  renderReminderCard();
}

// Init ‚Äî appel√© au DOMContentLoaded (script.js/_initPage s'en charge pour le reste)
document.addEventListener('DOMContentLoaded', () => {
  handleVotesOAuthCallback();
  renderReminderCard();
  loadRanking();
});
</script>

</body>
</html>
